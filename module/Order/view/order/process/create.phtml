<?php
$form->setAttributes([
    'action',
    $this->url('create-order')
])
    ->prepare();
echo $this->form()->openTag($form);
?>

<?php
$fileTransferRequestFieldset = $form->get('file_transfer_request');
$userFieldset = $fileTransferRequestFieldset->get('user');
$environmentFieldset = $fileTransferRequestFieldset->get('environment');
$logicalConnectionFieldset = $fileTransferRequestFieldset->get('logical_connection');
$serviceInvoicePositionBasicFieldset = $fileTransferRequestFieldset->get('service_invoice_position_basic');
$serviceInvoicePositionPersonalFieldset = $fileTransferRequestFieldset->get('service_invoice_position_personal');
$physicalConnectionsCollection = $logicalConnectionFieldset->get('physical_connections');
$endpointSourceFieldset = $physicalConnectionsCollection->getFieldsets()[0]->get('endpoint_source');
$endpointTargetFieldset = $physicalConnectionsCollection->getFieldsets()[0]->get('endpoint_target');
$applicationForSourceFieldset = $endpointSourceFieldset->get('application');
$customerForSourceFieldset = $endpointSourceFieldset->get('customer');
$serverForSourceFieldset = $endpointSourceFieldset->get('server');
$applicationForTargetFieldset = $endpointTargetFieldset->get('application');
$customerForTargetFieldset = $endpointTargetFieldset->get('customer');
$serverForTargetFieldset = $endpointTargetFieldset->get('server');
?>

<?php
// billing
$fieldgroupName = 'billing';
$fieldgroupCssClass = 'col-md-12';
$fieldgroupTitle = _('Billing');
$fieldgroupFormRows = [
    $this->formRow($fileTransferRequestFieldset->get('id')),
    '<div class="form-field-wrapper col-md-6">' . $this->formRow(
        $fileTransferRequestFieldset->get('application_number')) . '</div>',
    $this->formRow($environmentFieldset->get('severity')),
    '<div class="form-field-wrapper col-md-6">' . $this->formRow($environmentFieldset->get('name')) . '</div>',
    $this->formRow($fileTransferRequestFieldset->get('change_number')),
    '<div class="form-field-wrapper col-md-6">' . $this->formRow($serviceInvoicePositionBasicFieldset->get('number')) .
         '</div>',
        $this->formRow($userFieldset->get('id')),
        $this->formRow($userFieldset->get('username')),
        '<div class="form-field-wrapper col-md-6">' .
         $this->formRow($serviceInvoicePositionPersonalFieldset->get('number')) . '</div>'
];
echo $this->partial('/partials/fieldgroup', 
    [
        'fieldgroupName' => $fieldgroupName,
        'fieldgroupCssClass' => $fieldgroupCssClass,
        'fieldgroupTitle' => $fieldgroupTitle,
        'formRows' => $fieldgroupFormRows
    ]);
?>

<?php
// endpoint source (basic settings)
$fieldgroupName = 'basic-endpoint-source';
$fieldgroupCssClass = 'col-md-6';
$fieldgroupTitle = _('Source - basic settings');
$fieldgroupFormRows = [
    $this->formRow($endpointSourceFieldset->get('role')),
    $this->formRow($endpointSourceFieldset->get('contact_person')),
    $this->formRadio($endpointSourceFieldset->get('server_place')),
    $this->formRow($applicationForSourceFieldset->get('technical_short_name')),
    $this->formRow($customerForSourceFieldset->get('name')),
    $this->formRow($serverForSourceFieldset->get('name'))
];
echo $this->partial('/partials/fieldgroup', 
    [
        'fieldgroupName' => $fieldgroupName,
        'fieldgroupCssClass' => $fieldgroupCssClass,
        'fieldgroupTitle' => $fieldgroupTitle,
        'formRows' => $fieldgroupFormRows
    ]);
?>

<?php
// endpoint target (basic settings)
$fieldgroupName = 'basic-endpoint-target';
$fieldgroupCssClass = 'col-md-6';
$fieldgroupTitle = _('Target - basic settings');
$fieldgroupFormRows = [
    $this->formRow($endpointTargetFieldset->get('role')),
    $this->formRow($endpointTargetFieldset->get('contact_person')),
    $this->formRadio($endpointTargetFieldset->get('server_place')),
    $this->formRow($applicationForTargetFieldset->get('technical_short_name')),
    $this->formRow($customerForTargetFieldset->get('name')),
    $this->formRow($serverForTargetFieldset->get('name'))
];
echo $this->partial('/partials/fieldgroup', 
    [
        'fieldgroupName' => $fieldgroupName,
        'fieldgroupCssClass' => $fieldgroupCssClass,
        'fieldgroupTitle' => $fieldgroupTitle,
        'formRows' => $fieldgroupFormRows
    ]);
?>

<div class="clearer"></div>

<?php
// endpoint source (specific settings)
$fieldgroupName = 'specific-endpoint-source';
$fieldgroupCssClass = 'col-md-6';
$fieldgroupTitle = _('Source - specific settings');
$fieldgroupFormRows = [
    $this->formRow($endpointSourceFieldset->get('username'))
];
echo $this->partial('/partials/fieldgroup', 
    [
        'fieldgroupName' => $fieldgroupName,
        'fieldgroupCssClass' => $fieldgroupCssClass,
        'fieldgroupTitle' => $fieldgroupTitle,
        'formRows' => $fieldgroupFormRows
    ]);
?>

<?php
// endpoint target (specific settings)
$fieldgroupName = 'specific-endpoint-target';
$fieldgroupCssClass = 'col-md-6';
$fieldgroupTitle = _('Target - specific settings');
$fieldgroupFormRows = [
    $this->formRow($endpointTargetFieldset->get('username')),
    $this->formRow($endpointTargetFieldset->get('folder'))
];
echo $this->partial('/partials/fieldgroup', 
    [
        'fieldgroupName' => $fieldgroupName,
        'fieldgroupCssClass' => $fieldgroupCssClass,
        'fieldgroupTitle' => $fieldgroupTitle,
        'formRows' => $fieldgroupFormRows
    ]);
?>

<div class="clearer"></div>

<?php
// physical connections
$fieldgroupName = 'physical_connection_cd';
$fieldgroupCssClass = 'col-md-12';
$fieldgroupTitle = _('Connection');
$fieldgroupFormRows = [
    $this->formRow($physicalConnectionsCollection->getFieldsets()[0]->get('secure_plus'))
];
echo $this->partial('/partials/fieldgroup', 
    [
        'fieldgroupName' => $fieldgroupName,
        'fieldgroupCssClass' => $fieldgroupCssClass,
        'fieldgroupTitle' => $fieldgroupTitle,
        'formRows' => $fieldgroupFormRows
    ]);
?>

<div class="clearer"></div>

<div class="form-group">
    <div class="controls"><?php echo $this->formElement($form->get('submit')); ?></div>
</div>

<?php
echo $this->form()->closeTag();
?>
